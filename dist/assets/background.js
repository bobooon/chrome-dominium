import{d as i}from"./api.js";async function s(){return(await chrome.storage.local.get(["settings"])).settings||structuredClone(i)}async function o(t){await chrome.storage.local.set({settings:t})}async function c(){return(await chrome.commands.getAll())[1].shortcut}chrome.tabs.onCreated.addListener(async t=>{(await s()).closeEmpty||(await chrome.tabs.query({url:"chrome://newtab/"})).forEach(e=>{e.id&&e.id!==t.id&&chrome.tabs.remove(e.id)})});async function d(){const t=await chrome.windows.getCurrent({populate:!0});if(!t.tabs||t.tabs.length===0)return;const a=t.tabs.find(n=>n.active);if(!a||!a.id)return;const e=await s();if(!(e.closePinned&&a.pinned||e.closeGrouped&&a.groupId!==-1))try{t.tabs.filter(r=>!r.pinned&&r.groupId===-1&&r.id!==a.id).length||await chrome.tabs.create({}),await chrome.tabs.remove(a.id)}catch{}}chrome.runtime.onMessage.addListener((t,a,e)=>{switch(t.type){case"getSettings":return s().then(n=>e(n)),!0;case"saveSettings":o(t.payload);break;case"getShortcut":return c().then(n=>e(n)),!0}});chrome.commands.onCommand.addListener(t=>{t==="close"&&d()});
